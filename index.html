<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jedi Temple Interactive Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css" />
  <style>
    html, body { margin:0; padding:0; height:100%; }
    body { background:#0d0d0d; color:#0ff; font-family:'Segoe UI',sans-serif; }
    .control-btn { position:absolute; padding:8px 12px; background:#0ff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; box-shadow:0 0 10px rgba(0,255,255,0.4); z-index:1100; }
    #hamburger{top:10px;left:10px;} #highContrastToggle{top:10px;left:60px;} #resetBtn{top:10px;right:20px;} #screenshotBtn{top:10px;right:80px;}
    #searchBox{position:absolute;top:10px;left:140px;z-index:1100;background:rgba(0,0,0,0.8);padding:8px;border-radius:4px;}
    #searchInput{width:200px;padding:6px;border:none;border-radius:4px;background:#222;color:#0ff;}
    #sidebar{position:absolute;top:60px;left:0;width:260px;bottom:0;background:#111;padding:20px;overflow-y:auto;box-shadow:2px 0 8px rgba(0,255,255,0.1);z-index:1000;}
    #sidebar.collapsed{width:0;padding:0;overflow:hidden;}
    #sidebar h2{text-align:center;margin:0 0 10px;font-size:1.6em;font-weight:900;border-bottom:2px solid #0ff;padding-bottom:6px;}
    details{margin-bottom:8px;} summary{cursor:pointer;font-weight:700;font-size:1.1em;text-align:center;}
    #combatDetail summary{color:#1f8dd6;} #meditationDetail summary{color:#228b22;} #lectureDetail summary{color:#adff2f;}
    summary::-webkit-details-marker,summary::marker{display:none;}
    .poi-list{list-style:none;padding:0;margin:0 0 10px;}
    .poi-item{padding:6px;margin:4px 0;text-align:center;cursor:pointer;font-weight:600;}
    .sidebar-sep{border-top:1px solid #555;margin:6px 0;}
    #map{position:absolute;top:0;left:260px;right:0;bottom:0;z-index:500;}
  </style>
</head>
<body>
  <button id="hamburger" class="control-btn">â˜°</button>
  <button id="highContrastToggle" class="control-btn">âš™</button>
  <button id="resetBtn" class="control-btn">Reset</button>
  <button id="screenshotBtn" class="control-btn">ðŸ“·</button>
  <div id="searchBox"><input id="searchInput" placeholder="Search POI..."/></div>
  <div id="sidebar">
    <h2>Points of Interest</h2>
    <details id="combatDetail"><summary>Combat Rooms</summary><ul id="combatRooms" class="poi-list"></ul></details>
    <hr class="sidebar-sep"/>
    <details id="meditationDetail"><summary>Meditation Chambers</summary><ul id="meditationChambers" class="poi-list"></ul></details>
    <hr class="sidebar-sep"/>
    <details id="lectureDetail"><summary>Lecture Rooms</summary><ul id="lectureRooms" class="poi-list"></ul></details>
    <hr class="sidebar-sep"/>
    <ul id="poiList" class="poi-list"></ul>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
  <script>
    // Full POI data
    const pois = [ /* full POIs as before */ ];
    const colorMap = { /* your custom colorMap */ };
    const prefixMap = { 'Combat Room':'#1f8dd6','Meditation Chamber':'#90ee90','Lecture Room':'#006400' };
    function getColor(name) {
      return colorMap[name] || Object.entries(prefixMap).find(([k])=>name.startsWith(k))?.[1] || '#0ff';
    }
    let map, layers, currentMarker;
    function initMap() {
      map = L.map('map',{crs:L.CRS.Simple,zoomControl:true});
      const bounds=[[0,0],[7830,8192]];
      L.imageOverlay('JK-EODMAP.png',bounds).addTo(map);
      // Fit to full extent immediately
      map.fitBounds(bounds,{animate:false});
      map.setMaxBounds(bounds);
      layers={
        combat:L.layerGroup().addTo(map),
        meditation:L.layerGroup().addTo(map),
        lecture:L.layerGroup().addTo(map),
        others:L.layerGroup().addTo(map)
      };
      new L.Control.MiniMap(L.imageOverlay('JK-EODMAP.png',bounds),{toggleDisplay:true,mapOptions:{crs:L.CRS.Simple},zoomLevelFixed:map.getZoom()-2}).addTo(map);
    }
    function initSidebar() {
      const containers={combat:document.getElementById('combatRooms'),meditation:document.getElementById('meditationChambers'),lecture:document.getElementById('lectureRooms'),others:document.getElementById('poiList')};
      Object.values(containers).forEach(c=>c.innerHTML='');
      pois.forEach(p=>{
        if(p.name==='Holocron Vault')return;
        const col=getColor(p.name);
        const icon=L.divIcon({html:`<div style="width:20px;height:20px;border-radius:50%;background:${col};border:2px solid #fff;box-shadow:0 0 6px ${col};"></div>`,iconSize:[20,20]});
        const marker=L.marker([p.y,p.x],{icon}).bindPopup(`<strong>${p.name}</strong>`);
        let grp=layers.others;
        if(p.name.startsWith('Combat Room'))grp=layers.combat;
        else if(p.name.startsWith('Meditation Chamber'))grp=layers.meditation;
        else if(p.name.startsWith('Lecture Room'))grp=layers.lecture;
        grp.addLayer(marker);
        const li=document.createElement('li');li.className='poi-item';li.textContent=p.name;li.style.color=col;
        li.onclick=()=>{
          if(currentMarker&&currentMarker!==marker)map.removeLayer(currentMarker);
          if(!map.hasLayer(marker))map.addLayer(marker);
          currentMarker=marker;marker.openPopup();map.flyTo([p.y,p.x],map.getZoom(),{duration:1});
        };
        const key=grp===layers.combat?'combat':grp===layers.meditation?'meditation':grp===layers.lecture?'lecture':'others';
        containers[key].appendChild(li);
      });
      // Custom 'others' ordering
      const order=['Sentinel Quarters','Guardian Quarters','Consular Quarters','Main TG Dojo','TG Dojo #2','Trial Room','VIP Statues','Council Room','JAF Dojo','Combat Hall','Cantina','Lecture Hall','Archives','Saber Forge','Spawn','Questioning Room','Jails','Hangar Teleport'];
      const ul=containers.others,items=Array.from(ul.children);ul.innerHTML='';order.forEach(name=>{const it=items.find(li=>li.textContent===name);if(it)ul.appendChild(it);});
    }
    function initControls(){
      document.getElementById('hamburger').onclick=()=>document.getElementById('sidebar').classList.toggle('collapsed');
      document.getElementById('highContrastToggle').onclick=()=>document.body.classList.toggle('high-contrast');
      document.getElementById('resetBtn').onclick=()=>map.fitBounds([[0,0],[7830,8192]],{animate:false});
      document.getElementById('screenshotBtn').onclick=()=>html2canvas(document.getElementById('map')).then(c=>{const a=document.createElement('a');a.href=c.toDataURL();a.download='map.png';a.click();});
    }
    document.addEventListener('DOMContentLoaded',()=>{initMap();initSidebar();initControls();});
  </script>
</body>
</html>
